(function(){function f(){this.BaseElement_constructor();this.setup()}f.RULE_LODADED="onRuleLoaded";var e=facilis.extend(f,facilis.BaseElement);e.init=function(){};e.validate=function(){return false};e.getPossible=function(){return null};e.setup=function(){};facilis.validation.AbstractRule=facilis.promote(f,"BaseElement")})();
(function(){function f(){this.AbstractRule_constructor();this.connRules=null;this.setup()}f.rulesXML=facilis.View.getInstance().rootPath+"/rules/connectionRules.xml";var e=facilis.extend(f,facilis.validation.AbstractRule);e.validate=function(a){try{var b=a[0];console.log("from: "+b.elementType);var d=a[1];console.log("to: "+d.elementType);var c=a[2];if(b.elementType!="sflow"&&d.elementType!="sflow"){if(c=="sflow")if(!this.testSamePool(b,d)){console.log("flag 1");return false}if(!this.checkMiddle(b,
d,c)){console.log("flag 2");return false}}console.log("flag 3");if(b==d||this.exists(b,d,c))return false;console.log("flag 4");var g=d.elementType,h=this.getRule(b.elementType);if(h.getAttribute("single")&&h.getAttribute("single").indexOf(c)>=0&&!this.testFromLines(b,c))return false;var i;for(a=0;a<h.children.length;a++)if(h.children[a].getAttribute("to")==g){i=h.children[a];break}if(i&&i.getAttribute("valid"))if(i.getAttribute("valid").indexOf(c)<0)return false;var j=i.getAttribute("multi");if(!(j&&
j.indexOf(c)>=0))if(!this.testToLines(d,c))return false;return true}catch(k){}return false};e.getPossible=function(a){a=this.getRule(a.elementType);for(var b=[],d=0;d<a.children.length;d++){var c=a.children[d],g=c.getAttribute("to"),h=c.getAttribute("multi");c=c.getAttribute("valid");var i={};if(g)i.to=g;if(h)i.multi=h;if(c)i.valid=c;if(g||h||c)b.push(i)}return b};e.init=function(){var a=new createjs.LoadQueue;a.addEventListener("fileload",this.loaded.bind(this));a.loadFile(facilis.validation.ConnectionRule.rulesXML)};
e.loaded=function(a){this.connRules=a.result.children[0];this.dispatchEvent(new facilis.Event(facilis.validation.AbstractRule.RULE_LODADED))};e.testLoopBack=function(a,b,d){if(d=="sflow"){a=facilis.View.getInstance().getLineView().getLinesEndingIn(a);if(a.length){for(var c=d=0;c<a.length;c++)"sflow"==a[c].elementType&&a[c].getStartElement()==b&&d++;if(d==1)return true}}return false};e.testFromLines=function(a,b){for(var d=facilis.View.getInstance().getLineView().getLinesStartingIn(a),c=0;c<d.length;c++)if(d[c].elementType==
b)return false;return true};e.testToLines=function(a,b){for(var d=facilis.View.getInstance().getLineView().getLinesEndingIn(a),c=0;c<d.length;c++)if(d[c].elementType==b)return false;return true};e.getRule=function(a){var b=this.connRules.firstElementChild,d=0,c;for(d=0;d<b.children.length;d++)if(b.children[d].getAttribute("from")==a){c=b.children[d];break}return c};e.exists=function(a,b,d){for(var c=facilis.View.getInstance().getLineView().getLinesOf(a),g=0;g<c.length;g++){var h=c[g];if(h.getStartElement()==
a&&h.getEndElement()==b||h.getStartElement()==b&&h.getEndElement()==a&&d==h.elementType&&d!="sflow")return true}return false};e.checkMiddle=function(a,b,d){if(d=="sflow"&&b.elementType=="middleevent"){var c=b.getData();if(c)c=c.firstElementChild;for(var g=0;g<c.children.length;g++)if(c.children[g].getAttribute("name")=="attached"&&c.children[g].getAttribute("value")=="TRUE"&&b.parent)return false}if(d=="sflow"&&(b.elementType=="middleevent"||a.elementType=="middleevent"))if(b.elementType=="task"||
a.elementType=="task"||b.elementType=="csubflow"||a.elementType=="csubflow")if(b.elementType=="middleevent"&&a.containsContent(b))return false;else if(a.elementType=="middleevent"&&b.containsContent(a))return false;if(a.elementType=="gateway"){a=a.getData().firstElementChild;for(b=0;b<a.children.length;b++)if(a.children[b].getAttribute("name")=="gatewaytype"){a.children[b].getAttribute("value");break}}return true};e.testSamePool=function(a,b){if(!a.parent||!b.parent)return true;try{if(a.elementType==
"middleevent"&&(a.getContainer().elementType=="task"||a.getContainer().elementType=="csubflow"))a=a.getContainer()}catch(d){}try{if(b.elementType=="middleevent"&&(b.getContainer().elementType=="task"||b.getContainer().elementType=="csubflow"))b=b.getContainer()}catch(c){}if(a.getContainer()==null&&b.getContainer()==null||a.getContainer()==b.getContainer())return true;return false};e.setup=function(){};facilis.validation.ConnectionRule=facilis.promote(f,"AbstractRule")})();
(function(){function f(){this.AbstractRule_constructor();this.dropRules=null;this.setup()}f.rulesXML=facilis.View.getInstance().rootPath+"/rules/dropInRules.xml";var e=facilis.extend(f,facilis.validation.AbstractRule);e.validate=function(a){var b=a[0];a=a[1];if(b==a)return false;b=b.elementType;a=a.elementType;for(var d=this.dropRules,c=0;c<d.children.length;c++)if(d.children[c].getAttribute("from")==b)for(var g=d.children[c],h=0;h<g.children.length;h++)if(g.children[h].getAttribute("drop")==a)return true;
return false};e.init=function(){var a=new createjs.LoadQueue;a.addEventListener("fileload",this.loaded.bind(this));a.loadFile(facilis.validation.DropInRule.rulesXML)};e.loaded=function(a){this.dropRules=a.result.children[0];this.dispatchEvent(new facilis.Event(facilis.validation.AbstractRule.RULE_LODADED))};e.setup=function(){};facilis.validation.DropInRule=facilis.promote(f,"AbstractRule")})();
(function(){function f(){this.AbstractRule_constructor();this.dropRules=null;this.setup()}f.rulesXML=facilis.View.getInstance().rootPath+"/rules/dropRules.xml";var e=facilis.extend(f,facilis.validation.AbstractRule);e.validate=function(a){var b=a[0];a=a[1];if(b==a)return false;b=b.elementType;for(var d=a.elementType,c=this.dropRules,g=0;g<c.children.length;g++)if(c.children[g].getAttribute("from")==b)for(var h=c.children[g],i=0;i<h.children.length;i++)if(h.children[i].getAttribute("drop")==d){if(d==
"middleevent"&&(b=="task"||b=="csubflow")){a=facilis.View.getInstance().getLineView().getLinesEndingIn(a);for(b=0;b<a.length;b++)if(a[b].elementType=="sflow")return false}return true}return false};e.init=function(){var a=new createjs.XMLLoader((new createjs.LoadItem).set({src:facilis.validation.DropRule.rulesXML}));a.addEventListener("complete",this.loaded.bind(this));a.load()};e.loaded=function(a){this.dropRules=a.result.children[0];this.dispatchEvent(new facilis.Event(facilis.validation.AbstractRule.RULE_LODADED))};
e.setup=function(){};facilis.validation.DropRule=facilis.promote(f,"AbstractRule")})();
(function(){function f(){this.connectionRulesReady=this.dropInRulesReady=this.dropRulesReady=false}f._instance=null;f.allowInstantiation=false;f.getInstance=function(){if(f._instance==null){f.allowInstantiation=true;f._instance=new facilis.validation.RuleManager;facilis.EventDispatcher.initialize(f._instance);f.allowInstantiation=false}return f._instance};var e=facilis.extend(f,{});e.checkDropRule=function(a){return this.dropRules.validate(a)};e.checkDropInRule=function(a){return this.dropInRules.validate(a)};
e.checkConnectRule=function(a){return this.connectionRules.validate(a)};e.init=function(){this.dropRules=new facilis.validation.DropRule;this.dropRules.addEventListener(facilis.validation.AbstractRule.RULE_LODADED,this.dropReady.bind(this));this.dropInRules=new facilis.validation.DropInRule;this.dropInRules.addEventListener(facilis.validation.AbstractRule.RULE_LODADED,this.dropInReady.bind(this));this.connectionRules=new facilis.validation.ConnectionRule;this.connectionRules.addEventListener(facilis.validation.AbstractRule.RULE_LODADED,
this.connectionReady.bind(this));this.dropInRules.init();this.dropRules.init();this.connectionRules.init()};e.getConnectionRules=function(){return this.connectionRules};e.getDropRules=function(){return this.dropRules};e.getDropInRules=function(){return this.dropInRules};e.dropReady=function(){this.dropRulesReady=true;this.tryRulesReady()};e.dropInReady=function(){this.dropInRulesReady=true;this.tryRulesReady()};e.connectionReady=function(){this.connectionRulesReady=true;this.tryRulesReady()};e.tryRulesReady=
function(){this.dropRulesReady&&this.connectionRulesReady&&this.dropInRulesReady&&this.dispatchEvent(new facilis.Event(facilis.validation.RuleManager.RULES_LOADED))};facilis.validation.RuleManager=facilis.promote(f,"Object");facilis.validation.RuleManager.getInstance().init()})();
